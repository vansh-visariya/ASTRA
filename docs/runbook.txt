# Runbook for Async Federated Learning Experiments

## Quick Start

```bash
# 1. Install dependencies
pip install -r requirements.txt

# 2. Run demo (fast smoke test)
python main.py --config config.yaml --demo

# 3. Run full experiment
python main.py --config config.yaml --experiment-id my_exp
```

## Running Specific Experiments

### 1. Baseline FedAvg (IID, no adversaries)
```bash
python main.py --config config.yaml --experiment-id baseline_fedavg_sync_iid
```

### 2. Async without robust aggregation
```bash
python main.py --config config.yaml --experiment-id async_no_robust
```

### 3. Async with hybrid robust aggregation
```bash
python main.py --config config.yaml --experiment-id async_hybrid_robust
```

### 4. Async with hybrid + trust
```bash
python main.py --config config.yaml --experiment-id async_hybrid_trust
```

### 5. Async with hybrid + trust + DP
```bash
python main.py --config config.yaml --experiment-id async_hybrid_trust_dp
```

## Running All Experiments

```bash
python federated/experiments/run_experiment.py \
    --spec federated/experiments/experiments_spec.yaml \
    --config config.yaml \
    --output ./experiments_results
```

## Running Tests

```bash
# All tests
pytest federated/tests/ -v

# Specific test file
pytest federated/tests/test_aggregator.py -v

# With coverage
pytest federated/tests/ --cov=federated --cov-report=html
```

## Docker

```bash
# Build
docker build -t async-fl:latest .

# Run demo
docker run --gpus all -v $(pwd):/app async-fl:latest

# Run custom
docker run --gpus all -v $(pwd):/app async-fl:latest python main.py --config config.yaml
```

## Expected Runtime

- **Demo mode** (5 clients, 200 steps): < 3 minutes on CPU
- **Full experiment** (20 clients, 2000 steps): ~20-30 minutes on GPU

## Artifact Locations

- Config: `config.yaml`
- Logs: `./runs/<experiment_id>/logs/`
- Metrics: `./runs/<experiment_id>/metrics.jsonl`
- Metadata: `./runs/<experiment_id>/experiment_metadata.json`
- Checkpoints: `./runs/<experiment_id>/model_checkpoint.pt`

## Troubleshooting

### Import errors
Ensure all federated modules are in the Python path:
```bash
export PYTHONPATH="${PYTHONPATH}:$(pwd)"
```

### Slow training
- Reduce `total_steps` in config
- Use demo mode: `--demo`
- Reduce `num_clients`

### Memory issues
- Reduce `batch_size`
- Use CPU-only mode by not installing CUDA PyTorch

## Seeds Used

- Base seed: 20260221
- Each experiment has unique seed in experiments_spec.yaml for reproducibility
